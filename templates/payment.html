<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Side Navigation Bar</title>
	<link rel="stylesheet" type="text/css" href="home.css">
	<script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
    <style>@import url('https://fonts.googleapis.com/css?family=Josefin+Sans&display=swap');

    *{
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      list-style: none;
      text-decoration: none;
      font-family: 'Josefin Sans', sans-serif;
    }

    body{
       background-color: #f3f5f9;
    }

    .wrapper{
      display: flex;
      position: relative;
    }

    .wrapper .sidebar{
      width: 200px;
      height: 100%;
      background: #4b4276;
      padding: 30px 0px;
      position: fixed;
    }

    .wrapper .sidebar h2{
      color: #fff;
      text-transform: uppercase;
      text-align: center;
      margin-bottom: 30px;
    }

    .wrapper .sidebar ul li{
      padding: 15px;
      border-bottom: 1px solid #bdb8d7;
      border-bottom: 1px solid rgba(0,0,0,0.05);
      border-top: 1px solid rgba(255,255,255,0.05);
    }

    .wrapper .sidebar ul li a{
      color: #bdb8d7;
      display: block;
    }

    .wrapper .sidebar ul li a .fas{
      width: 25px;
    }

    .wrapper .sidebar ul li:hover{
      background-color: #594f8d;
    }

    .wrapper .sidebar ul li:hover a{
      color: #fff;
    }

    .wrapper .sidebar .social_media{
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
    }

    .wrapper .sidebar .social_media a{
      display: block;
      width: 40px;
      background: #594f8d;
      height: 40px;
      line-height: 45px;
      text-align: center;
      margin: 0 5px;
      color: #bdb8d7;
      border-top-left-radius: 5px;
      border-top-right-radius: 5px;
    }

    .wrapper .main_content{
      width: 100%;
      margin-left: 200px;
    }

    .wrapper .main_content .header{
      padding: 20px;
      background: #fff;
      color: #717171;
      border-bottom: 1px solid #e0e4e8;
    }

    .wrapper .main_content .info{
      margin: 20px;
      color: #717171;
      line-height: 25px;
    }
    .logout {
    position: absolute;
    bottom: 20px; /* Adjust the distance from the bottom as needed */
    right: 40px;
    width: 100%;
    text-align: center;
}

.logout a {
    color: #bdb8d7; /* Default color */
    text-decoration: none;
}

.logout a:hover {
    color: #fff; /* Color on hover */
    height:40px;
}

    .wrapper .main_content .info div{
      margin-bottom: 20px;
    }
    .dropdown-menu {
    display: none;
    position: absolute;
    background-color: #4b4276;
    width:184px;

}

.dropdown-menu a {
    display: block;
    color: #14c64d;
    text-decoration: none;
    padding: 10px;

}

.dropdown-menu li:hover a {
    background-color: #594f8d;
    color: #fff;
}

.main_content {
  width: 100%;
  display: flex;
  justify-content: center; /* Center content horizontally */
  align-items: center; /* Center content vertically */
}

.form-container {
  width: 80%; /* Adjust width as needed */
  padding: 20px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  text-align: center;
}

.form-container h2 {
  margin-bottom: 20px;
}

.form-container table {
  width: 100%;
}

.main_content {
  width: 100%;
  display: flex;
  justify-content: center; /* Center content horizontally */
  align-items: center; /* Center content vertically */
  flex-direction: column; /* Arrange items in a column layout */
}
.highlight {
        background: white;
        }
        li{
            border-radius: 20px;
        }
        .highlight:hover{
            cursor:pointer;
        }
.form-container {
  width: 80%; /* Adjust width as needed */
  padding: 20px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  text-align: center;
  margin-bottom: 20px; /* Add margin between containers */
}

.form-container h2 {
  margin-bottom: 20px;
}

.form-container table {
  width: 100%;
}

.form-container table th,
.form-container table td {
  padding: 10px;
  border-bottom: 1px solid #ddd;
  text-align: center;
}

.form-container table th {
  background-color: #f2f2f2;
}

.buttonClass {
  padding: 10px 20px;
  background-color: #4b4276;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}


        </style>
</head>
<body style="display: flex;">

<div class="wrapper" style="width:200px;">
    <div class="sidebar">
        <h2>PROFILE</h2>
        <ul>
            <li><a href="{{ url_for('home') }}"><i class="fas fa-home"></i>Home</a></li>
            <li><a href="{{ url_for('facility') }}"><i class="fas fa-bus"></i>Bus facilities</a></li>
            <li class="highlight"><a href="#" ><i class="fas fa-credit-card"></i>Payment</a></li>
            <li><a href="{{ url_for('contact') }}"><i class="fas fa-phone"></i>Contact</a></li>
            <li id="moreDropdown">
                    <a href="#"><i class="fas fa-info-circle"></i>More</a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('terms') }}">Terms and Conditions</a></li>
                        <li><a href="{{ url_for('privacy') }}">Privacy Policy</a></li>
                    </ul>
                </li>
        </ul>

        <div class="logout">
                <a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
    </div>
</div>
    <div class="main_content" style="width:1300px; ">


      <!-- Transaction History -->
<div class="form-container">
    <h2>Transaction History</h2>
    <table>
        <thead>
            <tr>
                <th>Transaction ID</th>
                <th>Roll no</th>
                <th>Amount</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for transaction in transaction_details %}
            <tr>
                <td>{{ transaction[0] }}</td>
                <td>{{ transaction[1]}}</td>
                <td>{{ transaction[2] }}</td>
                <td>
                    {% if transaction[3] == 1 %}
                        <i class="fas fa-check-circle" style="color: green;"></i> Success
                    {% else %}
                        <i class="fas fa-times-circle" style="color: red;"></i> Failed
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
   {% if session.stat == 1 %}
    <div class="form-container">
        <h2 style="color: green;">Payment</h2>
        <p style="font-weight: bold; color: green;"><i class="fas fa-check-circle"></i> You have no pending payments.</p>
    </div>
{% else %}
    <div class="form-container">
        <h2>Payment</h2>
        <p>Amount to be paid: ${{ session.amount}}</p> <!-- Display the amount -->
        <button type="button" class="buttonClass" onclick="initiatePayPal()">Make Payment</button>
        <!-- PayPal button container -->
        <div class="paypal-container" id="paypal-button-container"></div>
    </div>
{% endif %}

<script>
        // JavaScript for handling dropdown menu
        document.addEventListener("DOMContentLoaded", function() {
            var moreDropdown = document.getElementById("moreDropdown");
            var dropdownMenu = moreDropdown.querySelector(".dropdown-menu");

            function handleDropdownItemClick(event) {
        event.preventDefault();
        var target = event.target;
        if (target.tagName === "A") {
            var href = target.getAttribute("href");
            if (href) {
                window.location.href = href; // Redirect to the link's href
            }
        }
    }

    // Toggle dropdown on click
    moreDropdown.addEventListener("click", function(event) {
        event.preventDefault();
        if (dropdownMenu.style.display === "none" || dropdownMenu.style.display === "") {
            dropdownMenu.style.display = "block";
        } else {
            dropdownMenu.style.display = "none";
        }
    });

    // Close dropdown if clicked outside
    document.addEventListener("click", function(event) {
        if (!moreDropdown.contains(event.target)) {
            dropdownMenu.style.display = "none";
        }
    });

    // Add click event listener to dropdown menu items
    dropdownMenu.addEventListener("click", handleDropdownItemClick);
});
    </script>
         </script>
     <!-- Include the PayPal JavaScript SDK with Smart Payment Buttons -->
    <script src="https://www.paypal.com/sdk/js?client-id=AX0Wku0FLQHVVQKt5fvu4XpmraCQKgxKrYa99L4k-EcxANNwO5YDeYfyzBV4BypFj0uY4kng_pd1Qrlp&currency=USD&enable-funding=card"></script>

    <script>
    // PayPal button initialization
    function initiatePayPal() {
        // Render the PayPal Smart Payment Buttons into #paypal-button-container
        paypal.Buttons({
            style: {
                layout: 'horizontal'
            },
            createOrder: function (data, actions) {
                // Call the Flask endpoint to create a transaction ID
                createTransactionId();
                // Create the PayPal order
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: "{{ session.amount }}" // Change this value to the desired amount
                        }
                    }]
                });
            },
            onApprove: function (data, actions) {
                return actions.order.capture().then(function (details) {
                    // Send payment details to the Flask endpoint
                    sendPaymentDetailsToFlask(details);
                    // Optionally redirect to a success page or update the UI
                    alert('Transaction completed by ' + details.payer.name.given_name);
                });
            }
        }).render('#paypal-button-container');
    }

    // Function to call the Flask endpoint to create a transaction ID
    function createTransactionId() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/create_transaction_id", true); // Modify endpoint if necessary
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                console.log("Transaction ID created");
            }
        };
        xhr.send();
    }

    // Function to send payment details to Flask endpoint
    function sendPaymentDetailsToFlask(details) {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/payment_success", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                console.log("Payment details sent to Flask");
            }
        };
        xhr.send(JSON.stringify(details));
    }
</script>
</body>
</html>